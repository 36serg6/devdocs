<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Fastly troubleshooting | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">
	<meta http-equiv="last-modified" content="" />

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,700,600,300,800' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="/css/app.css" />
	<link rel="stylesheet" href="/css/print.css" media="print" />
	<link rel="canonical" href="//guides/v2.0/cloud/trouble/trouble_fastly.html">

    <!-- WebUI popover css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.css">

  <script>
    var baseUrl = "/";
  </script>

	<!-- crazyegg -->
	<script type="text/javascript">
	setTimeout(function(){var a=document.createElement("script");
	var b=document.getElementsByTagName("script")[0];
	a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0038/0321.js?"+Math.floor(new Date().getTime()/3600000);
	a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
	</script>

    <!-- heap analytics -->
    <script type="text/javascript">
        window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("2619540280");
    </script>

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body>

<header class="site-header">

	<nav id="global-nav">

		<div class="menu-btn"><a class="menu-trigger menu-icon" href="#"></a></div>

		<div class="container">

			<a class="logo" href="/guides/v2.0/"><img src="/i/m-logo.svg" alt=""><img src="/i/magento-logo.svg" alt="Magento" class="magento-logo" /><img src="/i/devdocs-logo.svg" alt="Devdocs" class="devdocs-logo" /></a>

			
<div class="version-switcher dropdown" data-version="2.0">
	<button id="version-switcher-button" class="btn btn-small dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Magento 2.0
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" href="/guides/v2.0/cloud/trouble/trouble_fastly.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" href="/guides/v2.1/cloud/trouble/trouble_fastly.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" href="/guides/v2.2/cloud/trouble/trouble_fastly.html">Magento 2.2</a></li>
	
  </ul>

</div>



			<!-- Main Navigation -->
<div class="nav-main">
  <ul>
    <li class="first">
      <a href="#">Setup and Deployment</a>
        <ul class="menu nav">
          <li><a href="/guides/v2.0/install-gde/bk-install-guide.html">Installation Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/comp-mgr/bk-compman-upgrade-guide.html">Component Manager and System Upgrade Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/config-guide/bk-config-guide.html">Configuration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/migration/bk-migration-guide.html">Migration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a></li>
          <li class="leaf"><a href="/magento-release-information.html">Release Information</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Development</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/architecture/bk-architecture.html">Architecture Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li>
          
          <li><a href="/guides/v2.0/payments-integrations/bk-payments-integrations.html">Payments Integrations</a></li>
          <li class="leaf"><a href="/guides/v2.0/mrg/intro.html">Module Reference Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/coding-standards/bk-coding-standards.html">Coding Standards</a></li>
          
          <li class="first leaf"><a href="/guides/v2.0/contributor-guide/contributing.html">Contributor Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Frontend</a>
        <ul class="menu nav">
          <li class="first leaf"><a href="/guides/v2.0/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/ui-components/ui-component.html">UI Components</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li>
          <li class="leaf"><a href="/guides/v2.0/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">API</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li>
          <li class="leaf"><a href="/guides/v2.0/rest/bk-rest.html">REST API Reference</a></li>
          <li class="leaf"><a href="/guides/v2.0/soap/bk-soap.html">SOAP API Reference</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Testing</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/test/testing.html">Magento Testing Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/mtf/mtf_introduction.html">Functional Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/integration/integration_test_execution.html">Integration Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/js/jasmine.html">JavaScript Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/unit/unit_test_execution.html">PHP Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li>
        </ul>
    </li>

    <li>
      <a href="/guides/v2.0/howdoi/bk-how-do-i.html">How Tos</a>
    </li>

    <li>
      <a href="/videos/">Videos</a>
    </li>
  </ul>
</div><!-- /.nav-main -->


			<div class="search-btn">
				<a class="search-trigger search-icon" href="/search.html"></a>
			</div>

			<form class="quick-search" action="/search.html" method="get">
				<input type="search" name="q" placeholder="Search" autocomplete="off" />
				<a href="#" class="quick-search-close">&times;</a>
			</form>

		</div>

	</nav><!-- #global-nav -->

</header>
<div class="nav-main-fader"></div>


<div id="gl-wrapper">

	<!-- .main-container -->
	<div class="main-container">
		<a id="main-content"></a>


<div class="container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">



<h4></h4>
<div class="left-navigation">
    <ul>
    
    

<li class="nav-level1  " id="welcome-to-magento-commerce-(cloud)">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/bk-cloud.html">Welcome to Magento Commerce (Cloud)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="subscriptions-and-plans">
            
            
        
            
            <a href="/guides/v2.0/cloud/basic-information/cloud-plans.html">Subscriptions and plans</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="starter-architecture">
            
            
        
            
            <a href="/guides/v2.0/cloud/basic-information/starter-architecture.html">Starter architecture</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="starter-develop-and-deploy-workflow">
            
            
        
            
            <a href="/guides/v2.0/cloud/basic-information/starter-develop-deploy-workflow.html">Starter develop and deploy workflow</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="pro-architecture">
            
            
        
            
            <a href="/guides/v2.0/cloud/reference/discover-arch.html">Pro architecture</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="pro-develop-and-deploy-workflow">
            
            
        
            
            <a href="/guides/v2.0/cloud/welcome/discover-workflow.html">Pro develop and deploy workflow</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="onboarding-tasks">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/onboarding/onboarding-tasks.html">Onboarding tasks</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="onboarding-portal-management">
            
            
        
            
            <a href="/guides/v2.0/cloud/onboarding/onboarding-portal.html">Onboarding Portal management</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="prepare-project-environments">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-project-owner.html">Prepare project environments</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="technologies-and-requirements">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/requirements/cloud-requirements.html">Technologies and requirements</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="composer">
            
            
        
            
            <a href="/guides/v2.0/cloud/reference/cloud-composer.html">Composer</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="github">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-integrate-github.html">GitHub</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="fastly">
            
            
        
            
            <a href="/guides/v2.0/cloud/basic-information/cloud-fastly.html">Fastly</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="ssh-and-sftp">
            
            
        
            
            <a href="/guides/v2.0/cloud/env/environments-ssh.html">SSH and sFTP</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="new-relic-apm">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/new-relic.html">New Relic APM</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="blackfire-profiler">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-integrate-blackfire.html">Blackfire Profiler</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="first-time-local-environment-setup">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/access-acct/first-time-setup.html">First-time local environment setup</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="prepare-for-local-environment-setup">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-workspace.html">Prepare for local environment setup</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="install-magento-prerequisites">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-workspace-magento-prereqs.html">Install Magento prerequisites</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="enable-ssh-keys">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-workspace-ssh.html">Enable SSH keys</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="set-up-the-magento-file-system-owner">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-workspace-file-sys-owner.html">Set up the Magento file system owner</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="clone-and-branch-the-project">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-setup-env-2_clone.html">Clone and branch the project</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="install-magento">
            
            
        
            
            <a href="/guides/v2.0/cloud/before/before-setup-env-install.html">Install Magento</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="first-time-deployment">
            
            
        
            
            <a href="/guides/v2.0/cloud/access-acct/first-time-deploy.html">First time deployment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="import-an-existing-magento-project">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Import an existing Magento project</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="first-steps-for-importing-magento-commerce">
                    

                    
                    <a  href="/guides/v2.0/cloud/access-acct/first-time-setup_import-first-steps.html">First steps for importing Magento Commerce</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="find-the-information-you-need-for-your-import">
                    

                    
                    <a  href="/guides/v2.0/cloud/access-acct/first-time-setup_import-prereq.html">Find the information you need for your import</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="prepare-your-existing-magento-commerce-system">
                    

                    
                    <a  href="/guides/v2.0/cloud/access-acct/first-time-setup_import-prepare.html">Prepare your existing Magento Commerce system</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="import-magento-commerce-into-magento-commerce-(cloud)">
                    

                    
                    <a  href="/guides/v2.0/cloud/access-acct/first-time-setup_import-import.html">Import Magento Commerce into Magento Commerce (Cloud)</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="configure-magento-commerce-(cloud)">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/configure/configuration-overview.html">Configure Magento Commerce (Cloud)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="set-up-fastly">
            
            
        
            
            <a href="/guides/v2.0/cloud/access-acct/fastly.html">Set up Fastly</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="custom-fastly-vcl-snippets">
            
            
        
            
            <a href="/guides/v2.0/cloud/configure/cloud-vcl-custom-snippets.html">Custom Fastly VCL snippets</a>
            

            
        </li>
        
        
        
        
        
        
        <li class="nav-level2  " id="set-up-multiple-cloud-websites-or-stores">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-multi-sites.html">Set up multiple Cloud websites or stores</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="set-up-cron-jobs">
            
            
        
            
            <a href="/guides/v2.0/cloud/configure/setup-cron-jobs.html">Set up cron jobs</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id=".magento.app.yaml">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-conf-files_magento-app.html">.magento.app.yaml</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configure-routes">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Configure routes</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="routes.yaml">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_routes.html">routes.yaml</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="caching">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-routes-more-cache.html">Caching</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="redirects">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-routes-more-redir.html">Redirects</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="server-side-includes">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-routes-more-ssi.html">Server side includes</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configure-services">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Configure services</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="services.yaml">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services.html">services.yaml</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="set-up-mysql-service">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services-mysql.html">Set up MySQL service</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="set-up-redis-service">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services-redis.html">Set up Redis service</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="set-up-solr-service">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services-solr.html">Set up Solr service</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="set-up-elasticsearch-service">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services-elastic.html">Set up Elasticsearch service</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="set-up-rabbitmq-service">
                    

                    
                    <a  href="/guides/v2.0/cloud/project/project-conf-files_services-rabbit.html">Set up RabbitMQ service</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="manage-your-project">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/project/projects.html">Manage your project</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="configure-your-project">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-webint-basic.html">Configure your project</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="project-structure">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-start.html">Project structure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="create-and-manage-users">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/user-admin.html">Create and manage users</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="manage-branches-with-the-interface">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-webint-branch.html">Manage branches with the Interface</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="manage-branches-with-the-cli">
            
            
        
            
            <a href="/guides/v2.0/cloud/env/environments-start.html">Manage branches with the CLI</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="snapshots-and-backup-management">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-webint-snap.html">Snapshots and backup management</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="manage-your-environments">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/env/environments.html">Manage your environments</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="magento-cloud-cli">
            
            
        
            
            <a href="/guides/v2.0/cloud/reference/cli-ref-topic.html">Magento Cloud CLI</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configuration-management">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/sens-data-over.html">Configuration management</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="example-of-managing-system-specific-settings">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/sens-data-initial.html">Example of managing system-specific settings</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="environment-variables">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Environment variables</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="overview-of-environment-variables">
                    

                    
                    <a  href="/guides/v2.0/cloud/env/environment-vars_over.html">Overview of environment variables</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="magento-application-environment-variables">
                    

                    
                    <a  href="/guides/v2.0/cloud/env/environment-vars_magento.html">Magento application environment variables</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="magento-commerce-(cloud)-environment-variables">
                    

                    
                    <a  href="/guides/v2.0/cloud/env/environment-vars_cloud.html">Magento Commerce (Cloud) environment variables</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configuration-reference">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Configuration reference</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="all-configuration-paths-except-payments-reference">
                    

                    
                    <a  href="/guides/v2.0/cloud/live/config-reference-most.html">All configuration paths except payments reference</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="payment-configuration-paths-reference">
                    

                    
                    <a  href="/guides/v2.0/cloud/live/config-reference-payment.html">Payment configuration paths reference</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="sensitive-configuration-paths-reference">
                    

                    
                    <a  href="/guides/v2.0/cloud/live/config-reference-sens.html">Sensitive configuration paths reference</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="upgrades-and-patches">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="upgrade-magento-commerce-(cloud)">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-upgrade.html">Upgrade Magento Commerce (Cloud)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="patch-magento-commerce-(cloud)">
            
            
        
            
            <a href="/guides/v2.0/cloud/project/project-patch.html">Patch Magento Commerce (Cloud)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="upgrade-from-2.0.4-(cloud)">
            
            
        
            
            <a href="/guides/v2.0/cloud/upgrade/upgrade-from-2-0-4.html">Upgrade from 2.0.4 (Cloud)</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="deploy-your-store">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/live/stage-prod-live.html">Deploy your store</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="deployment-process">
            
            
        
            
            <a href="/guides/v2.0/cloud/reference/discover-deploy.html">Deployment process</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="continuous-deployment">
            
            
        
            
            <a href="/guides/v2.0/cloud/deploy/continuous-deployment.html">Continuous deployment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="protective-block">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/live-prot.html">Protective block</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="build-and-deploy-on-local">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/live-sanity-check.html">Build and deploy on local</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="prepare-to-deploy-to-staging-and-production">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/stage-prod-migrate-prereq.html">Prepare to deploy to Staging and Production</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="migrate-and-deploy-code,-static-files,-and-data">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/stage-prod-migrate.html">Migrate and deploy code, static files, and data</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="test-deployment">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/stage-prod-test.html">Test deployment</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="go-live-and-launch">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/live/live.html">Go live and launch</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="go-live-checklist">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/go-live-checklist.html">Go live checklist</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="launch-steps">
            
            
        
            
            <a href="/guides/v2.0/cloud/live/launch-steps.html">Launch steps</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="troubleshooting">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.0/cloud/trouble/trouble.html">Troubleshooting</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="add-staging-and-production-to-pro-projects-ui">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/pro-env-management.html">Add Staging and Production to Pro projects UI</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="troubleshoot-deployment">
            
            
        
            
            <a href="/guides/v2.0/cloud/access-acct/trouble.html">Troubleshoot deployment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="view-logs-for-troubleshooting">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/environments-logs.html">View logs for troubleshooting</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="incorrect-credentials">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble_ce-creds.html">Incorrect credentials</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="resolve-issues-with-a-new-project">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble_proj-startover.html">Resolve issues with a new project</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="component-deployment-failure">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble_comp-deploy-fail.html">Component deployment failure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="fastly-troubleshooting">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble_fastly.html">Fastly troubleshooting</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="redis-troubleshooting">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/redis-troubleshooting.html">Redis troubleshooting</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="resolve-issues-with-encryption-key">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble-crypt-key-variable.html">Resolve issues with encryption key</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="resolve-issues-with-html-minification">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble-error-html-minification.html">Resolve issues with HTML minification</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="resolve-issues-with-google-analytics-during-deployment">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/trouble-google-analytics-deploy.html">Resolve issues with Google Analytics during deployment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="add-sitemap-and-robots.txt">
            
            
        
            
            <a href="/guides/v2.0/cloud/trouble/robots-sitemap.html">Add sitemap and robots.txt</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="how-to">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <span>How To</span>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="install-and-update-extensions">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Install and update extensions</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="install-extensions">
                    

                    
                    <a  href="/guides/v2.0/cloud/howtos/install-components.html">Install extensions</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="update-extensions">
                    

                    
                    <a  href="/guides/v2.0/cloud/howtos/update-components.html">Update extensions</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="merge-and-delete-an-environment-(tutorial)">
            
            
        
            
            <a href="/guides/v2.0/cloud/howtos/environment-tutorial-env-merge.html">Merge and delete an environment (tutorial)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="install-a-theme">
            
            
        
            
            <a href="/guides/v2.0/cloud/howtos/custom-theme.html">Install a theme</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="install-optional-sample-data">
            
            
        
            
            <a href="/guides/v2.0/cloud/howtos/sample-data.html">Install optional sample data</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="run-a-php-debugger">
            
            
        
            
            <a href="/guides/v2.0/cloud/howtos/debug.html">Run a PHP debugger</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    </ul>
</div>

	</div>

</aside>


<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <a class="breadcrumb-item" href="/guides/v2.0/"><span>Home</span></a>

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">

        
          <a property="item" typeof="WebPage" href="/guides/v2.0/cloud/bk-cloud.html">
            <span property="name">Welcome to Magento Commerce (Cloud)</span>
          </a>
        

        <meta property="position" content="1" />
      </li>

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">Fastly troubleshooting</span>

        

        <meta property="position" content="2" />
      </li>

    

    



    </ol>

  </nav>



	

	

	<h1 class="page-heading">Fastly troubleshooting</h1>

  


</section>


			<p>For information setting up and configuring Fastly, see <a href="/guides/v2.0/cloud/access-acct/fastly.html">Set up Fastly</a>.</p>

<p>To verify the Fastly extension is working or to debug the Fastly extension, you can use the <code class="highlighter-rouge">curl</code> command to display certain response headers. The values of these response headers indicate whether or not Fastly is enabled and functioning properly. You can further investigate issues based on the values of headers and caching behavior.</p>

<h2 id="curl-live">Test your live site</h2>
<p>First, check your live site to verify the response headers with <code class="highlighter-rouge">curl</code>. The command goes through the Fastly extension to receive responses. If you don’t receive the correct headers, then you should test the <a href="#cloud-test-stage">origin servers directly</a>. This command returns the values of the <code class="highlighter-rouge">Fastly-Magento-VCL-Uploaded</code> and <code class="highlighter-rouge">X-Cache</code> headers.</p>

<p>If you don’t have a live site set up with DNS, you can use either a static route or you can use the optional <code class="highlighter-rouge">--resolve</code> flag, which bypasses DNS name resolution.</p>

<p>Check for headers with a <strong>dig command</strong> to the URL. In a terminal application, enter <code class="highlighter-rouge">dig &lt;url&gt;</code> to verify Fastly services display in the headers. For additional <code class="highlighter-rouge">dig</code> tests, see Fastly’s <a href="https://docs.fastly.com/guides/basic-configuration/testing-setup-before-changing-domains" target="_blank">Testing before changing DNS</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dig http[s]://&lt;your domain&gt;
</code></pre>
</div>

<p>Check response headers with <strong>curl command</strong>:</p>

<ol>
  <li>
    <p>In a terminal, enter the following command to test your live site URL:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> curl http://&lt;live URL&gt; -vo /dev/null -HFastly-Debug:1 [--resolve]
</code></pre>
    </div>

    <p>Use <code class="highlighter-rouge">--resolve</code> only if your live URL isn’t set up with DNS and you don’t have a static route set.
 For example: <code class="highlighter-rouge">curl http://www.mymagento.biz -vo /dev/null -HFastly-Debug:1</code></p>
  </li>
  <li>
    <p>Verify the <a href="#response-headers">response headers</a> to ensure Fastly is working. The output for this command is similar to curl Staging and Production. For example, you should see the returned unique headers by this command:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> &lt; Fastly-Magento-VCL-Uploaded: yes
 &lt; X-Cache: HIT, MISS
</code></pre>
    </div>
  </li>
</ol>

<h2 id="cloud-test-stage">Test your Staging and Production sites</h2>
<p>This section discusses how to use <code class="highlighter-rouge">dig</code> and <code class="highlighter-rouge">curl</code> to get response headers from your Staging or Production site (the origin servers). You never need to test on the Integration environments. Basically, you are curling the edge for responses.</p>

<p><strong>Note:</strong> If you encounter issues when using <code class="highlighter-rouge">dig</code> and <code class="highlighter-rouge">curl</code> to the direct origin servers, not through the live server domain, the issue may not be Fastly.</p>

<h3 id="dig">dig command</h3>
<p>First, check for headers with a dig command to the URL. In a terminal application, enter <code class="highlighter-rouge">dig &lt;url&gt;</code> to verify Fastly services display in the headers. For additional <code class="highlighter-rouge">dig</code> tests, see Fastly’s <a href="https://docs.fastly.com/guides/basic-configuration/testing-setup-before-changing-domains" target="_blank">Testing before changing DNS</a>.</p>

<p>For example:</p>

<ul>
  <li>Staging: <code class="highlighter-rouge">dig http[s]://staging.&lt;your domain&gt;.c.&lt;instanceid&gt;.ent.magento.cloud</code></li>
  <li>Production: <code class="highlighter-rouge">dig http[s]://&lt;your domain&gt;.{1|2|3}.&lt;project ID&gt;.ent.magento.cloud</code></li>
</ul>

<h3 id="curl">curl command</h3>
<p>Next, use a <code class="highlighter-rouge">curl</code> command to verify X-Magento-Tags exist and additional header information. The command format differs for Staging and Production.</p>

<p>For more information on these commands, you bypass Fastly when you inject <code class="highlighter-rouge">-H "host:URL"</code>, replace with origin to connecting location (CNAME information from your OneDrive Spreadsheet), <code class="highlighter-rouge">-k</code> ignores SSL, and <code class="highlighter-rouge">-v</code> provides verbose responses. If headers display correctly, check the live site and verify headers again.</p>

<ul>
  <li>If header issues occur when directly hitting the origin servers bypassing Fastly, you may have issues in your code, with extensions, or with the infrastructure.</li>
  <li>If you encounter no errors directly hitting the origin servers, but headers are missing hitting the live domain through Fastly, you may have Fastly errors.</li>
</ul>

<p><strong>Staging:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl http[s]://staging.&lt;your domain&gt;.c.&lt;instanceid&gt;.ent.magento.cloud -H "host: &lt;url&gt;" -k -vo /dev/null -HFastly-Debug:1
</code></pre>
</div>

<p><strong>Production:</strong></p>

<p>The load balancer:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl http[s]://&lt;your domain&gt;.c.&lt;project ID&gt;.ent.magento.cloud -H "host: &lt;url&gt;" -k -vo /dev/null -HFastly-Debug:1
</code></pre>
</div>

<p>A direct Origin node:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl http[s]://&lt;your domain&gt;.{1|2|3}.&lt;project ID&gt;.ent.magento.cloud -H "host: &lt;url&gt;" -k -vo /dev/null -HFastly-Debug:1
</code></pre>
</div>

<p>For example, if you have a public URL <code class="highlighter-rouge">www.mymagento.biz</code>, enter a command similar to the following to test the production site:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl -k https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud -H 'Host: www.mymagento.biz' -vo /dev/null -HFastly-Debug:1
</code></pre>
</div>

<p>If you do not have DNS set up for a public host name, enter a command similar to the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl -k https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud -vo /dev/null -HFastly-Debug:1
</code></pre>
</div>

<h3 id="response-headers">Check response headers</h3>
<p>Check the returned response headers and values:</p>

<ul>
  <li>Fastly-Magento-VCL-Uploaded should be present</li>
  <li>X-Magento-Tags should be returned</li>
  <li>Fastly-Module-Enabled should be either Yes or the Fastly extension version number</li>
  <li>X-Cache should be either <code class="highlighter-rouge">HIT</code> or <code class="highlighter-rouge">HIT, HIT</code></li>
  <li>x-cache-hits should be 1,1</li>
  <li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9" target="_blank">Cache-Control: max-age</a> should be greater than 0</li>
  <li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32" target="_blank">Pragma</a> should be <code class="highlighter-rouge">cache</code></li>
</ul>

<p>The following example shows the correct values for <code class="highlighter-rouge">Pragma</code>, <code class="highlighter-rouge">X-Magento-Tags</code>, and <code class="highlighter-rouge">Fastly-Module-Enabled</code>.</p>

<p>The output for cURL commands can be lengthy. The following is a summary only:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>* STATE: INIT =&gt; CONNECT handle 0x600057800; line 1402 (connection #-5000)
* Rebuilt URL to: https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud/
* Added connection 0. The cache now contains 1 members
*   Trying 192.0.2.31...
* STATE: CONNECT =&gt; WAITCONNECT handle 0x600057800; line 1455 (connection #0)
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                             Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Connected to www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud (54.229.163.31) port 443 (#0)
* STATE: WAITCONNECT =&gt; SENDPROTOCONNECT handle 0x600057800; line 1562 (connection #0)
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* ALPN, offering h2

  ... portion omitted for brevity ...

&lt; Set-Cookie: mage-messages=%5B%5D; expires=Wed, 22-Nov-2017 17:39:58 GMT; Max-Age=31536000; path=/
&lt; Pragma: cache
&lt; Expires: Wed, 23 Nov 2016 17:39:56 GMT
&lt; Cache-Control: max-age=86400, public, s-maxage=86400, stale-if-error=5, stale-while-revalidate=5
&lt; X-Magento-Tags: cb_welcome_popup store cb cb_store_info_mobile cb_header_promotional_bar cb_store_info cb_discount-promo-bar cpg_2 cb_83 cb_81 cb_84 cb_85 cb_86 cb_87 cb_88 cb_89 p5646 catalog_product p5915 p6040 p6197 p6227 p7095 p6109 p6122 p6331 p7592 p7651 p7690
&lt; Fastly-Module-Enabled: yes
&lt; Strict-Transport-Security: max-age=31536000
	&lt; Content-Security-Policy: upgrade-insecure-requests
&lt; X-Content-Type-Options: nosniff
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Frame-Options: SAMEORIGIN
&lt; X-Platform-Server: i-dff64b52
&lt;
* STATE: PERFORM =&gt; DONE handle 0x600057800; line 1955 (connection #0)
* multi_done
  0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0
* Connection #0 to host www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud left intact
</code></pre>
</div>

<h2 id="vcl-uploaded">Determine if VCL is not uploaded</h2>
<p>To determine if the VCL snippets are not uploaded, check the following:</p>

<ul>
  <li><strong>Top level navigation does not work</strong>: The top level navigation relies on Edge Side Includes (ESI) processing which is not enabled by default. When you upload the Magento VCL snippets during configuration, ESIs are enabled. See <a href="/guides/v2.0/cloud/access-acct/fastly.html#upload-vcl-snippets">Upload Fastly VCL snippets</a>.</li>
  <li><strong>Pages are not caching</strong>: By default Fastly doesn’t cache pages with Set-Cookies. Magento sets Cookies even on cacheable pages (TTL &gt; 0). Magento Fastly VCL strips those cookies on cacheable pages. This may also happen if page block in a template is marked uncacheable. If this occurs, it’s due to a 3rd party module or Magento extension blocking or removing the Magento headers. See <a href="#xcache-miss">X-Cache missed section</a> for details.</li>
  <li><strong>Geo-location/GeoIP does not work</strong>: The uploaded Magento Fastly VCL snippets append the country code to the URL. See <a href="/guides/v2.0/cloud/access-acct/fastly.html#upload-vcl-snippets">Upload Fastly VCL snippets</a>.</li>
</ul>

<h2 id="resolve-errors-found-by-curl">Resolve errors found by cURL</h2>
<p>This section provides suggestions for resolving errors you might find using the <code class="highlighter-rouge">curl</code> command.</p>

<h3 id="no-module">Fastly-Module-Enabled is not present</h3>
<p>If you don’t receive a “yes” for the <code class="highlighter-rouge">Fastly-Module-Enabled</code> in the response headers, you need to verify the Fasty module is installed and selected.</p>

<p>To verify Fastly is enabled in Staging and Production, check the configuration in the Magento Admin for each environment:</p>

<ol>
  <li>Log into the Admin console for Staging and Production using the URL with /admin (or the changed Admin URL).</li>
  <li>Navigate to <strong>Stores</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong>. Scroll and click <strong>Full Page Cache</strong>.</li>
  <li>Ensure Fastly CDN is selected.</li>
  <li>Click on <strong>Fastly Configuration</strong>. Ensure the Fastly Service ID and Fastly API token are entered (your Fastly credentials). Verify you have the correct credentials entered for the Staging and Production environment. Click <strong>Test credentials</strong> to help.</li>
  <li>
    <p>Edit your <code class="highlighter-rouge">composer.json</code> and ensure the Fasty module is included with version. This file has all modules listed with versions.</p>

    <ul>
      <li>In the “require” section, you should have <code class="highlighter-rouge">"fastly/magento2": &lt;version number&gt;</code></li>
      <li>
        <p>In the “repositories” section, you should have:</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>  "fastly-magento2": {
              "type": "vcs",
              "url": "https://github.com/fastly/fastly-magento2.git"
      }
</code></pre>
        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>If you use <a href="/guides/v2.0/cloud/live/sens-data-over.html#cloud-config-specific-recomm">Configuration Management</a>, you should have a configuration file. Edit the <code class="highlighter-rouge">app/etc/config.app.php</code> (2.0, 2.1) or <code class="highlighter-rouge">app/etc/config.php</code> (2.2) file and make sure the setting <code class="highlighter-rouge">'Fastly_Cdn' =&gt; 1</code> is correct. The setting should not be <code class="highlighter-rouge">'Fastly_Cdn' =&gt; 0</code> (meaning disabled).</p>

    <p>If you enabled Fastly, delete the configuration file and run the <code class="highlighter-rouge">bin/magento magento-cloud:scd-dump</code> command to update. For a walk-through of this file, see <a href="/guides/v2.0/cloud/live/sens-data-initial.html">Example of managing system-specific settings</a>.</p>
  </li>
</ol>

<p>If the module is not installed, you need to install in an Integration environment branch and deployed to Staging and Production. See <a href="/guides/v2.0/cloud/access-acct/fastly.html">Set up Fastly</a> for instructions.</p>

<h3 id="no-VCL">Fastly-Magento-VCL-Uploaded is not present</h3>
<p>During installation and configuration, you should have uploaded the Fastly VCL. These are the base VCL snippets provided by the Fastly module, not custom VCL snippets you create. For instructions, see <a href="/guides/v2.0/cloud/access-acct/fastly.html#upload-vcl-snippets">Upload Fastly VCL snippets</a>.</p>

<h3 id="xcache-miss">X-Cache includes MISS</h3>
<p>If <code class="highlighter-rouge">X-Cache</code> is either <code class="highlighter-rouge">HIT, MISS</code> or <code class="highlighter-rouge">MISS, MISS</code>, enter the same <code class="highlighter-rouge">curl</code> command again to make sure the page wasn’t recently evicted from the cache.</p>

<p>If you get the same result, use the <a href="#curl"><code class="highlighter-rouge">curl</code> commands</a> and verify the <a href="#response-headers">response headers</a>:</p>

<ul>
  <li><code class="highlighter-rouge">Pragma</code> is <code class="highlighter-rouge">cache</code></li>
  <li><code class="highlighter-rouge">X-Magento-Tags</code> exists</li>
  <li><code class="highlighter-rouge">Cache-Control: max-age</code> is greater than 0</li>
</ul>

<p>If the issue persists, another extension is likely resetting these headers. Repeat the following procedure in Staging to disable extensions to find which one is causing the issue. After you locate the extension(s) causes issues, you will need to disable the extension(s) in Production.</p>

<ol>
  <li>Log in to the Magento Admin on your Staging or Production site.</li>
  <li>Navigate to <strong>Stores</strong> &gt; <strong>Settings</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>Advanced</strong>.</li>
  <li>In the Disable Modules Output section in the right pane, locate and disable all of your extensions*.</li>
  <li>Click <strong>Save Config</strong>.</li>
  <li>Click <strong>System</strong> &gt; <strong>Tools</strong> &gt; <strong>Cache Management</strong>.</li>
  <li>Click <strong>Flush Magento Cache</strong>.</li>
  <li>Now enable one extension at a time, saving the configuration and flushing the Magento cache.</li>
  <li>Try the <a href="#curl"><code class="highlighter-rouge">curl</code> commands</a> and verify the <a href="#response-headers">response headers</a>.</li>
  <li>Repeat steps 8 and 9 to enable and test the <code class="highlighter-rouge">curl</code> commands. When the Fastly headers no longer display, you have found the extension causing issues with Fastly.</li>
</ol>

<p>When you isolate the extension that is resetting Fastly headers, contact the extension developer for additional assistance. We cannot provide fixes or updates for 3rd party extension developers to work with Fastly caching.</p>

<h2 id="purge">Purges do not process</h2>
<p>If you attempt to use a Fastly purge option, and it does not process, you may have incorrect Fastly credentials in your environment or may have encountered an issue. You may receive the error: “The purge request was not processed successfully.”</p>

<h3 id="check-fasty-credentials">Check Fasty credentials</h3>
<p>Verify if you have the correct Fastly Service ID and API token in your environment. If you have Staging credentials in Production, the purges may not process or process incorrectly.</p>

<ol>
  <li>Log in to your local Magento Admin as an administrator.</li>
  <li>Click <strong>Stores</strong> &gt; <strong>Settings</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong> and expand <strong>Full Page Cache</strong>.</li>
  <li>Expand <strong>Fastly Configuration</strong> and verify the Fastly Service ID and API token for your environment.</li>
  <li>If you modify the values, click <strong>Test Credentials</strong>.</li>
</ol>

<h3 id="check-vcl-snippets">Check VCL snippets</h3>
<p>If the credentials are correct, you may have issues with your VCLs. To list and review your VCLs per service, enter the following API call in a terminal:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl -X GET -s https://api.fastly.com/service/&lt;Service ID&gt;/version/&lt;Editable Version #&gt;/snippet/ -H "Fastly-Key:FASTLY_API_TOKEN"
</code></pre>
</div>

<p>Review the list of VCLs. If you have issues with the default VCLs from Fastly, you can upload again or verify the content per the <a href="https://github.com/fastly/fastly-magento2/tree/master/etc/vcl_snippets" target="_blank">Fastly default VCLs</a>. For editing your custom VCLs, see <a href="/guides/v2.0/cloud/configure/cloud-vcl-custom-snippets.html">Custom Fastly VCL snippets</a>.</p>

<h4 id="related-topics">Related topics</h4>
<ul>
  <li><a href="/guides/v2.0/cloud/basic-information/cloud-fastly.html">Fastly in Cloud</a></li>
  <li><a href="/guides/v2.0/cloud/access-acct/fastly.html">Set up Fastly</a></li>
  <li><a href="/guides/v2.0/cloud/configure/cloud-vcl-custom-snippets.html">Custom Fastly VCL snippets</a></li>
</ul>

		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  

  
   <div class="github-link">
     <a class="improve-page" href="https://github.com/magento/devdocs/tree/develop/guides/v2.0/cloud/trouble/trouble_fastly.md" target="_blank">
       Edit this page on GitHub
     </a>
   </div>
  

  <div class="new-issue">
    <a href="https://github.com/magento/devdocs/issues/new?title=&body=Feedback on page: /guides/v2.0/cloud/trouble/trouble_fastly.html" target="_blank">Give us feedback</a>
  </div>

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.container -->


	</div>
	<!-- /.main-container -->

</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div id="footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav">
        <li><a href="/guides/v2.0/contributor-guide/contributing_docs.html">Become a Contributor</a>
        <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
        <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
        <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
        <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
        <li><a href="/guides/v2.0/release-notes/bk-release-notes.html">Release Notes</a></li>
        <li><a href="/magento-third-party.html">Third-Party Licenses</a></li> 
      </ul>
    </div>

		<div class="copyright-date">&copy; 2017 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/common/js/app.min.js"></script>

<!-- Glossary integration -->
<script src="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.js"></script>
<script src="/common/js/glossary.tooltip.min.js"></script>
<script>
    $(document).ready(function(){
      magento.glossary.init("https://magento.github.io/glossary/data/content-glossary.xml",function(term){return term.types.includes("glossary");},magento.glossary.tooltip.init);
      });
</script>

<script type="text/javascript">
    (function() {
        var didInit = false;
        function initMunchkin() {
            if(didInit === false) {
                didInit = true;
                Munchkin.init('585-GGD-959', {cookieAnon: false});
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>



<!--Google Analytics-->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-66243208-1', 'auto');
    ga('send', 'pageview');
</script>


</body>
</html>

